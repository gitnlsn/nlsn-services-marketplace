<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payments: The Engine of Commerce</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
</head>
<body>
    <h1>Payments: The Engine of Commerce</h1>

    <p>Our payment system is designed to be secure, transparent, and fair to both clients and professionals.</p>

    <h2>The Foundation: Pagarme</h2>

    <p>We've partnered with Pagarme, a leading payment gateway in Brazil, to handle all of our payment processing. This allows us to offer a wide range of payment methods, including credit cards, Pix, and boleto, while ensuring the highest level of security.</p>

    <h2>The Escrow Model: A Circle of Trust</h2>

    <p>We use an escrow model to protect both parties in a transaction:</p>

    <ol>
        <li><strong>The Commitment:</strong> When a client books a service, they pay the full amount to our platform. This shows that they are serious about the service and have the funds to pay for it.</li>
        <li><strong>The Safety Net:</strong> The funds are held in our Pagarme account until the service is completed. This gives the professional the confidence to start working, knowing that they will be paid.</li>
        <li><strong>The Reward:</strong> Once either the client or the professional notifies the platform that the service is complete, the funds are released to the professional's platform account, minus our service fee. These funds become available for withdrawal after a 15-day holding period to allow for dispute resolution.</li>
    </ol>

    <h2>The Withdrawal Process: Your Money, Your Way</h2>

    <p>We want to make it as easy as possible for our users to access their earnings.</p>

    <ol>
        <li><strong>The Request:</strong> A user can request a withdrawal from their platform account at any time.</li>
        <li><strong>The Transfer:</strong> We process the request and transfer the funds to the user's registered bank account via the Pagarme API.</li>
        <li><strong>The Confirmation:</strong> The user receives a notification that the transfer is complete.</li>
    </ol>

    <h2>Diagrams</h2>

    <h3>Booking Flow</h3>
    <pre class="mermaid">
        sequenceDiagram
            participant "User (as Client)"
            participant "User (as Professional)"
            participant Frontend
            participant Backend
            participant Pagarme
            participant Twilio

            "User (as Client)"->>Frontend: Selects a service to book
            Frontend->>Backend: POST /api/bookings (serviceId)
            Backend->>Pagarme: Create Charge
            Pagarme-->>Backend: Returns payment details
            Backend-->>Frontend: Displays payment instructions
            "User (as Client)"->>Pagarme: Completes payment
            Pagarme->>Backend: Webhook notification (payment success)
            Backend->>Backend: Update booking status to "Paid", credit professionals account balance
            Backend->>Twilio: Send booking confirmation to Client
            Backend->>Twilio: Send new booking alert to Professional
            Backend->>Frontend: Notify client of success
            "User (as Professional)"->>Backend: Notifies service complete
            "User (as Client)"->>Backend: (Optional) Notifies service complete
            Backend->>Backend: Funds held for 15 days
            Backend->>"User (as Professional)": Funds available for withdrawal after 15 days

            

            
    </pre>

    <h3>Withdrawal Flow</h3>
    <pre class="mermaid">
        sequenceDiagram
            participant "User (as Professional)"
            participant Frontend
            participant Backend
            participant Pagarme
            participant Twilio

            "User (as Professional)"->>Frontend: Requests withdrawal
            Frontend->>Backend: POST /api/withdrawals (amount)
            Backend->>Backend: Verify user balance and process request
            Backend->>Pagarme: Initiate Transfer to user\'s bank account
            Pagarme-->>Backend: Confirmation of transfer
            Backend->>Backend: Update user\'s balance
            Backend->>Twilio: Send withdrawal confirmation to Professional
            Backend-->>Frontend: Notify user of successful withdrawal

            
    </pre>
</body>
</html>
